#!/bin/bash

function die () {
  echo >&2 "${1}"
  exit 1
}

START_DIR=$(pwd)
JAR="$(cd $(dirname ${1}) && pwd)/$(basename ${1})"
DESTINATION="${2}"
shift 2

for dir in ${@} ; do
  cd ${START_DIR} && cd $(cd ${dir} && pwd) \
  && mvn -DskipTests=true compile \
  && cd target/classes \
  && classes="$(find . -type f -amin -5)" && if [ -z "${classes}" ] ; then classes="./*" ; fi \
  && jar uvf ${JAR} ${classes} \
  || die "Error building: ${dir}"
done

scp ${JAR} ${DESTINATION}
