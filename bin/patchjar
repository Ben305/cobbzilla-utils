#!/bin/bash

function die () {
  echo >&2 "${1}"
  exit 1
}

JAR="$(cd $(dirname ${1}) && pwd)/$(basename ${1})"
DESTINATION="${2}"
shift 2

for dir in ${@} ; do
  cd $(cd ${dir} && pwd) \
  && mvn -DskipTests=true compile \
  && cd target/classes \
  && jar uvf ${JAR} ./* \
  || die "Error building: ${dir}"
done

scp ${JAR} ${DESTINATION}
